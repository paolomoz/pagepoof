name = "pagepoof-api"
main = "src/index.ts"
compatibility_date = "2024-01-01"
compatibility_flags = ["nodejs_compat"]

[vars]
ENVIRONMENT = "development"
VERTEX_LOCATION = "us-central1"
ANALYTICS_ENDPOINT = "https://pagepoof-analytics.paolomoz.workers.dev"

# Required secrets (set via `wrangler secret put <NAME>`):
# - ANTHROPIC_API_KEY: Claude API key for content generation
# - GOOGLE_AI_API_KEY: Gemini API key for layout selection
# - GOOGLE_SERVICE_ACCOUNT_JSON: Full JSON of GCP service account for Imagen 3
# - VERTEX_PROJECT_ID: GCP project ID for Vertex AI
# - OPENAI_API_KEY: OpenAI API key for multi-agent analysis (optional, for cross-validation)
# - DA_TOKEN: AEM Document Authoring token for persistence

# R2 bucket for generated images
[[r2_buckets]]
binding = "IMAGES"
bucket_name = "pagepoof-images"

# KV namespace for sessions/cache
[[kv_namespaces]]
binding = "CACHE"
id = "952b8e54906544eeb271cfa2c41189f9"

# Vectorize for RAG
[[vectorize]]
binding = "VECTORIZE"
index_name = "pagepoof-rag"

# Workers AI for embeddings
[ai]
binding = "AI"

# D1 database for product data
[[d1_databases]]
binding = "DB"
database_name = "pagepoof-db"
database_id = "5b077fcc-8272-4360-874f-10fdbcb13652"

# ============================================
# SETUP INSTRUCTIONS
# ============================================
# 1. Create resources:
#    wrangler r2 bucket create pagepoof-images
#    wrangler kv:namespace create CACHE
#    wrangler d1 create pagepoof-db
#    wrangler vectorize create pagepoof-rag --dimensions=768 --metric=cosine
#
# 2. Update the placeholder IDs above with actual IDs from the create commands
#
# 3. Set secrets:
#    wrangler secret put ANTHROPIC_API_KEY
#    wrangler secret put GOOGLE_AI_API_KEY
#    wrangler secret put GOOGLE_SERVICE_ACCOUNT_JSON
#    wrangler secret put VERTEX_PROJECT_ID
#    wrangler secret put DA_TOKEN
#
# 4. Deploy:
#    wrangler deploy
